document.addEventListener("DOMContentLoaded",function(){let e={labels:["啟動","暫停","待機"],datasets:[{data:[0,0,0],backgroundColor:["rgba(255, 0, 0, 0.2)","rgba(255, 165, 0, 0.2)","rgba(0, 128, 0, 0.2)",],borderColor:["#ff0000","#ffa500","#008000"],borderWidth:1},]},t={type:"bar",data:e,options:{scales:{y:{beginAtZero:!0,ticks:{stepSize:1,color:"#2f0000"},max:Math.max(...e.datasets[0].data)+1,grid:{color:"#e0e0e0"}},x:{ticks:{color:"#2f0000"},grid:{color:"#e0e0e0"}}},plugins:{legend:{display:!1}},layout:{padding:15}}},r=[],o=[],s=0,n=0,c=[],a=0,i=0,l={activation:0,suspension:0,standby:0},u=new Audio("https://tadralling.com/dist/dashboard/digital-alarm.mp3");u.loop=!0;let d=new Chart(document.getElementById("status-chart"),t);Chart.defaults.font.size=20;class ${constructor(e){this.id=Date.now(),this.name=e,this.count=0}}function y(e){return e<10?`0${e}`:`${e}`}function m(e,t){document.querySelector(e).addEventListener("keydown",e=>{"Enter"===e.key&&document.querySelector(t).click()})}function S(e,t){let r=window.screen.width,o=document.querySelector(e),s=document.querySelector(t),n=o.clientHeight;r<=768?s.setAttribute("style",`height: ${.8*window.screen.height}px;`):r<=1200&&"#timer-area"===e?s.setAttribute("style",`height: ${.8*window.screen.height}px;`):s.setAttribute("style",`height: ${n-120}px;`)}function q(){let e=new Date,t=0,r="",o="";12>e.getHours()?(r="AM",t=e.getHours()):12===e.getHours()?(r="PM",t=e.getHours()):(r="PM",t=e.getHours()-12),0===e.getDay()&&(o="星期日"),1===e.getDay()&&(o="星期一"),2===e.getDay()&&(o="星期二"),3===e.getDay()&&(o="星期三"),4===e.getDay()&&(o="星期四"),5===e.getDay()&&(o="星期五"),6===e.getDay()&&(o="星期六"),document.querySelector("#hrs").innerHTML=y(t),document.querySelector("#min").innerHTML=y(e.getMinutes()),document.querySelector("#sec").innerHTML=y(e.getSeconds()),document.querySelector("#session").innerHTML=r,document.querySelector("#yer").innerHTML=e.getFullYear(),document.querySelector("#mon").innerHTML=e.getMonth()+1,document.querySelector("#day").innerHTML=e.getDate(),document.querySelector("#weeks").innerHTML=o}function g(e,t){let s=Math.floor(t/100);document.querySelector(`#t-sec-${e}`).innerHTML=y(s%60),document.querySelector(`#t-min-${e}`).innerHTML=y(Math.floor(s/60%60)),document.querySelector(`#t-hrs-${e}`).innerHTML=y(Math.floor(s/3600%100)),r[o.indexOf(parseInt(e))].count=t}function p(e){e.addEventListener("click",t=>{let s=t.target.dataset.id,n=o.indexOf(parseInt(s));if("開始"===e.innerHTML){let c=new Worker("https://tadralling.com/dist/dashboard/counter.min.js");c.postMessage({count:r[n].count}),c.onmessage=function(e){g(s,e.data.count)},e.addEventListener("click",()=>{c.terminate()},{once:!0}),e.innerHTML="暫停"}else e.innerHTML="開始"})}function L(e,t){e.addEventListener("click",e=>{let s=e.target.dataset.id,n=o.indexOf(parseInt(s));"開始"!==t.innerHTML&&t.click(),r[n].count=0,g(s,r[n].count)})}function h(e,t){e.addEventListener("click",e=>{let s=e.target.dataset.id,n=o.indexOf(parseInt(s)),c=document.getElementById(s);"開始"!==t.innerHTML&&t.click(),r.splice(n,1),o.splice(n,1),c.remove()})}function f(e){let t=Math.floor(e/100);document.querySelector("#s-tms").innerHTML=y(e%100),document.querySelector("#s-sec").innerHTML=y(t%60),document.querySelector("#s-min").innerHTML=y(Math.floor(t/60%60)),document.querySelector("#s-hrs").innerHTML=y(Math.floor(t/3600%100)),s=e}function M(e){e.addEventListener("click",e=>{let t=e.target.dataset.id,r=c.indexOf(parseInt(t)),o=document.getElementById(t);c.splice(r,1),o.remove()})}function T(e){let t=Math.abs(parseInt(e,10));return!0===isNaN(t)?0:t}function H(e){let t=Math.floor(e/100);document.querySelector("#c-sec").innerHTML=y(Math.floor(t%3600%60)),document.querySelector("#c-min").innerHTML=y(Math.floor(t%3600/60)),document.querySelector("#c-hrs").innerHTML=y(Math.floor(t/3600)),i=e}function b(e,t){let r=Math.floor(e/t*100);!0===isNaN(r)&&(r=0),document.querySelector("#percent-number").innerHTML=y(r),document.querySelector("#graph-percent").style.strokeDashoffset=`${(100-r)/100*439.824}`}function v(){let t=document.querySelector("#status-area"),r=0,o={activation:0,suspension:0,standby:0},s=0,n=0;function c(e,r){let o=t.querySelector(e);0===r&&(o.querySelector(".standby").classList.add("show"),o.querySelector(".suspension").classList.remove("show"),o.querySelector(".activation").classList.remove("show"),o.querySelector(".light").classList.add("green"),o.querySelector(".light").classList.remove("orange"),o.querySelector(".light").classList.remove("red")),1===r&&(o.querySelector(".standby").classList.remove("show"),o.querySelector(".suspension").classList.add("show"),o.querySelector(".activation").classList.remove("show"),o.querySelector(".light").classList.remove("green"),o.querySelector(".light").classList.add("orange"),o.querySelector(".light").classList.remove("red")),2===r&&(o.querySelector(".standby").classList.remove("show"),o.querySelector(".suspension").classList.remove("show"),o.querySelector(".activation").classList.add("show"),o.querySelector(".light").classList.remove("green"),o.querySelector(".light").classList.remove("orange"),o.querySelector(".light").classList.add("red"))}document.querySelectorAll(".record").forEach(e=>{r++}),document.querySelectorAll(".timer").forEach(e=>{let t=0;e.querySelectorAll("span").forEach(e=>{"00"!==e.innerHTML&&t++}),"開始"!==e.querySelector("#t-start-pause").innerHTML?o.activation++:0!==t?o.suspension++:o.standby++});let u,$;u=document.querySelector("#stopwatch-area"),$=0,u.querySelectorAll("span").forEach(e=>{"00"!==e.innerHTML&&$++}),s="開始"!==u.querySelector("#s-start-pause").innerHTML?2:1!==$?1:0;n="開始"!==document.querySelector("#countdown-timer-area").querySelector("#c-start-pause").innerHTML?2:i!==a?1:0,c(".stopwatch",s),c(".countdown-timer",n),t.querySelector("#stopwatch-record-count").innerHTML=r,t.querySelector("#countdown-timer-percent").innerHTML=document.querySelector("#percent-number").innerHTML,t.querySelector("#timer-count").innerHTML=o.activation+o.suspension+o.standby,(l.activation!==o.activation||l.suspension!==o.suspension||l.standby!==o.standby)&&(d.data.datasets[0].data[0]=o.activation,d.data.datasets[0].data[1]=o.suspension,d.data.datasets[0].data[2]=o.standby,d.options.scales.y.max=Math.max(...e.datasets[0].data)+1,d.update(),l=o)}S("#stopwatch-record-area","#stopwatch-records"),S("#timer-area","#timer-columns"),localStorage.getItem("timerList")&&(r=JSON.parse(localStorage.getItem("timerList"))),localStorage.getItem("timerIdList")&&(o=JSON.parse(localStorage.getItem("timerIdList"))),localStorage.getItem("timerHTML")&&(document.querySelector("#timer-columns").innerHTML=localStorage.getItem("timerHTML"),document.querySelectorAll(".timer").forEach(e=>{let t=e.querySelector("#t-start-pause"),r=e.querySelector("#t-reset"),o=e.querySelector("#t-delete");p(t),L(r,t),h(o,t)})),localStorage.getItem("stopwatchCount")&&f(s=parseInt(localStorage.getItem("stopwatchCount"),10)),localStorage.getItem("recordNum")&&(n=parseInt(localStorage.getItem("recordNum"),10)),localStorage.getItem("recordIdList")&&(c=JSON.parse(localStorage.getItem("recordIdList"))),localStorage.getItem("recordHTML")&&(document.querySelector("#stopwatch-records").innerHTML=localStorage.getItem("recordHTML"),document.querySelectorAll(".record").forEach(e=>{M(e.querySelector("#s-delete"))})),localStorage.getItem("countdownTimerInit")&&localStorage.getItem("countdownTimerCount")&&(a=parseInt(localStorage.getItem("countdownTimerInit"),10),H(i=parseInt(localStorage.getItem("countdownTimerCount"),10)),b(i,a)),q(),v(),setInterval(q,1e3),setInterval(v,100),window.addEventListener("unload",()=>{localStorage.clear();let e=document.querySelector("#mode-toggle").checked;localStorage.setItem("darkMode",e),document.querySelectorAll(".timer").forEach(e=>{let t=e.querySelector("#t-start-pause");"開始"!==t.innerHTML&&(t.innerHTML="開始")});let t=document.querySelector("#timer-columns");localStorage.setItem("timerList",JSON.stringify(r)),localStorage.setItem("timerIdList",JSON.stringify(o)),localStorage.setItem("timerHTML",t.innerHTML);let l=document.querySelector("#stopwatch-records");localStorage.setItem("recordIdList",JSON.stringify(c)),localStorage.setItem("stopwatchCount",s),localStorage.setItem("recordNum",n),localStorage.setItem("recordHTML",l.innerHTML),localStorage.setItem("countdownTimerInit",a),localStorage.setItem("countdownTimerCount",i)}),document.querySelector("#mode-toggle").addEventListener("change",function(){this.checked?(document.querySelector("body").classList.add("dark-mode"),document.querySelector("#mode-status").classList.add("dark"),document.querySelector("#mode-status").classList.remove("light"),d.config.options.scales.y.ticks.color="#e0e0e0",d.config.options.scales.x.ticks.color="#e0e0e0",d.config.options.scales.y.grid.color="#3c3c3c",d.config.options.scales.x.grid.color="#3c3c3c",d.data.datasets[0].backgroundColor[0]="rgba(246, 121, 194, 0.3)",d.data.datasets[0].backgroundColor[1]="rgba(243, 157, 104, 0.3)",d.data.datasets[0].backgroundColor[2]="rgba(185, 210, 177, 0.3)",d.data.datasets[0].borderColor[0]="#f679c2",d.data.datasets[0].borderColor[1]="#f39d68",d.data.datasets[0].borderColor[2]="#b9d2b1"):(document.querySelector("body").classList.remove("dark-mode"),document.querySelector("#mode-status").classList.remove("dark"),document.querySelector("#mode-status").classList.add("light"),d.config.options.scales.y.ticks.color="#2f0000",d.config.options.scales.x.ticks.color="#2f0000",d.config.options.scales.y.grid.color="#e0e0e0",d.config.options.scales.x.grid.color="#e0e0e0",d.data.datasets[0].backgroundColor[0]="rgba(255, 0, 0, 0.2)",d.data.datasets[0].backgroundColor[1]="rgba(255, 160, 66, 0.2)",d.data.datasets[0].backgroundColor[2]="rgba(0, 128, 0, 0.2)",d.data.datasets[0].borderColor[0]="#ff0000",d.data.datasets[0].borderColor[1]="#ffa042",d.data.datasets[0].borderColor[2]="#008000"),d.update()}),localStorage.getItem("darkMode")?"true"===localStorage.getItem("darkMode")&&document.querySelector("#mode-toggle").click():window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&document.querySelector("#mode-toggle").click(),m("#input-timer-name","#t-build"),document.querySelector("#t-build").onclick=function(){if(""!==document.querySelector("#input-timer-name").value){let e=Math.max(...o),t=document.getElementById(e),s=document.querySelector("#input-timer-name").value;document.querySelector("#input-timer-name").value="";let n=new $(s);r.push(n),o.push(n.id);let c=document.createElement("div");c.setAttribute("class","timer"),c.setAttribute("id",n.id),c.innerHTML='<div class="title"><h3>'+n.name+'</h3></div><div class="times"><p><span id="t-hrs-'+n.id+'">00</span> 時 <span id="t-min-'+n.id+'">00</span> 分 <span id="t-sec-'+n.id+'">00</span> 秒</p></div><div class="controls"><button id="t-start-pause" data-id="'+n.id+'">開始</button><button id="t-reset" data-id="'+n.id+'">歸零</button><button id="t-delete" data-id="'+n.id+'">刪除</button></div>',""===document.querySelector("#timer-columns").innerHTML?document.querySelector("#timer-columns").appendChild(c):document.querySelector("#timer-columns").insertBefore(c,t);let a=document.getElementById(n.id),i=a.querySelector("#t-start-pause"),l=a.querySelector("#t-reset"),u=a.querySelector("#t-delete");p(i),L(l,i),h(u,i)}},document.querySelector("#t-clean").onclick=function(){document.querySelectorAll(".timer").forEach(e=>{let t=e.querySelector("#t-start-pause");"開始"!==t.innerHTML&&t.click()}),document.querySelector("#timer-columns").innerHTML="",r=[],o=[]},document.querySelector("#s-start-pause").onclick=function(){if("開始"===document.querySelector("#s-start-pause").innerHTML){let e=new Worker("https://tadralling.com/dist/dashboard/counter.min.js");e.postMessage({count:s}),e.onmessage=function(e){f(e.data.count)},document.querySelector("#s-start-pause").addEventListener("click",()=>{e.terminate()},{once:!0}),document.querySelector("#s-start-pause").innerHTML="暫停"}else document.querySelector("#s-start-pause").innerHTML="開始"},document.querySelector("#s-reset").onclick=function(){"開始"!==document.querySelector("#s-start-pause").innerHTML&&document.querySelector("#s-start-pause").click(),f(s=0)},document.querySelector("#s-record").onclick=function(){n++;let e=Math.max(...c),t=document.getElementById(e),r=document.querySelector("#s-tms").innerHTML,o=document.querySelector("#s-sec").innerHTML,s=document.querySelector("#s-min").innerHTML,a=document.querySelector("#s-hrs").innerHTML,i=Date.now();c.push(i);let l=document.createElement("div");l.setAttribute("class","record"),l.setAttribute("id",i),l.innerHTML='<div class="times"><p>#'+n+"&emsp;&emsp;"+a+" 時 "+s+" 分 "+o+" 秒<span> "+r+'</span></p></div><div class="record-controls"><button id="s-delete" data-id="'+i+'">刪除</button></div>',""===document.querySelector("#stopwatch-records").innerHTML?document.querySelector("#stopwatch-records").appendChild(l):document.querySelector("#stopwatch-records").insertBefore(l,t);M(document.querySelector("#stopwatch-records").querySelector("#s-delete"))},document.querySelector("#s-clean").onclick=function(){document.querySelector("#stopwatch-records").innerHTML="",n=0,c=[]},m("#input-c-sec","#send"),m("#input-c-min","#send"),m("#input-c-hrs","#send"),document.querySelector("#send").onclick=function(){let e=0,t=document.querySelector("#input-c-sec").value,r=document.querySelector("#input-c-min").value,o=document.querySelector("#input-c-hrs").value;""!==t&&(e+=100*T(t)),""!==r&&(e+=6e3*T(r)),""!==o&&(e+=36e4*T(o)),e>35999900?(i=35999900,a=35999900):(i=e,a=e),H(i),b(i,a),document.querySelector("#input-c-sec").value="",document.querySelector("#input-c-min").value="",document.querySelector("#input-c-hrs").value=""},document.querySelector("#c-start-pause").onclick=function(){if(0!==i){if("開始"===document.querySelector("#c-start-pause").innerHTML){let e=new Worker("https://tadralling.com/dist/dashboard/countdown.min.js");e.postMessage({count:i}),e.onmessage=function(e){let t=e.data.count;H(t),b(i,a),0===t&&u.play()},document.querySelector("#c-start-pause").addEventListener("click",()=>{e.terminate()},{once:!0}),document.querySelector("#c-start-pause").innerHTML="暫停"}else document.querySelector("#c-start-pause").innerHTML="開始"}else u.pause(),u.currentTime=0,H(i=a),b(i,a),document.querySelector("#c-start-pause").innerHTML="開始"},document.querySelector("#c-reset").onclick=function(){"開始"!==document.querySelector("#c-start-pause").innerHTML&&document.querySelector("#c-start-pause").click(),u.pause(),u.currentTime=0,H(i=a),b(i,a)}});